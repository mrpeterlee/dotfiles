#  █████╗       ██████╗ █████╗ ██████╗   #
# ██╔══██╗     ██╔════╝██╔══██╗██╔══██╗  #
# ███████║     ██║     ███████║██████╔╝  #
# ██╔══██║     ██║     ██╔══██║██╔═══╝   #
# ██║  ██║     ╚██████╗██║  ██║██║       #
# ╚═╝  ╚═╝      ╚═════╝╚═╝  ╚═╝╚═╝       #
#                                        #
# ████████╗███╗   ███╗██╗   ██╗██╗  ██╗  #
# ╚══██╔══╝████╗ ████║██║   ██║╚██╗██╔╝  #
#    ██║   ██╔████╔██║██║   ██║ ╚███╔╝   #
#    ██║   ██║╚██╔╝██║██║   ██║ ██╔██╗   #
#    ██║   ██║ ╚═╝ ██║╚██████╔╝██╔╝ ██╗  #
#    ╚═╝   ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═╝  #
#
#  ▓▓▓▓▓▓▓▓▓▓
# ░▓ author ▓ Peter Lee (peter.lee@astrocapital.net)
# ░▓ update ▓ Last Update: 2024-Jul-05 17:32:54
# ░▓ repo   ▓ 
# ░▓▓▓▓▓▓▓▓▓▓
# ░░░░░░░░░░

# ----------========== Tmux General ==========---------- #
unbind-key y
set -g mouse on

# No confirmation needed to kill pane
bind t set status
bind a set-window-option synchronize-panes \; display-message "█▓░ synchronize"
bind : command-prompt

# Remove confirmation
bind-key x kill-pane
bind & kill-window

# WARNING: DO NOT SET IT ANYWHERE CLOSE TO 1MM Lines --> TMUX becomes sluggish
set -g history-limit 100000

# force Vi mode
#   really you should export VISUAL or EDITOR environment variable, see manual
set -g status-keys vi
set -g mode-keys vi

# Vim style pane selection
bind y select-pane -L
bind h select-pane -D 
bind a select-pane -U
bind e select-pane -R

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Use Alt-arrow keys without prefix key to switch panes
# bind -n M-Left select-pane -L
# bind -n M-Right select-pane -R
# bind -n M-Up select-pane -U
# bind -n M-Down select-pane -D

# Shift arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# Shift Alt vim keys to switch windows
# bind -n M-H previous-window
# bind -n M-L next-window

set -g @catppuccin_flavour 'mocha'

# set vi-mode
set-window-option -g mode-keys vi
# keybindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# -------------------- General -------------------- #
set -g default-command $SHELL
set -g default-shell $SHELL

# Display image inside nvim / tmux
set -gq allow-passthrough on
set -g visual-activity off

# set-option -g mouse-utf8 off

# Setup true color
# allow terminal scrolling
# set-option -g terminal-overrides 'xterm*:smcup@:rmcup@'
set-option -sa terminal-features ',xterm-256color:RGB'

# enable OSC 52 clipboard
set -s set-clipboard on
#:XT:Ms Ms modifies OSC 52 clipboard handling to work with mosh, see
# https://gist.github.com/yudai/95b20e3da66df1b066531997f982b57b
set -ag terminal-overrides "vte*:XT:Ms=\\E]52;c;%p2%s\\7,xterm*:XT:Ms=\\E]52;c;%p2%s\\7"

# clipboard menu
bind Space display-popup -w 70% -h 70% -E "CM_OUTPUT_CLIP=1 clipmenu | yank"

# emoji menu
bind e display-popup -w 70% -h 70% -E "emoji"

# Required for Vim Tmux Clipboard sharing
set -g focus-events on

# Remove esc delay
set -sg escape-time 0


# -------------------- Key bindings -------------------- #
bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "~/.config/tmux/tmux.conf reloaded"

# Copy mode (Vim-like)
bind-key -n 'C-M-c' copy-mode

bind P paste-buffer

# Also copy to system clipboard
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -sel clip -i'

# map copy mode to ctrl+alt+c

bind-key -n "C-;" paste-buffer

# bind-key -n "C-'" copy-mode
bind-key -n F4 copy-mode
bind "'" copy-mode

# bind-key -T copy-mode-vi Escape send-keys -X cancel
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'V' send-keys -X select-line


# bind-key -T copy-mode-vi "'" send -X copy-selection      # Yank selection in copy mode.
# bind-key -T copy-mode-vi ''' send-keys -X copy-pipe-and-cancel "xsel -i -p && xsel -o -p | xsel -i -b"
bind-key -T copy-mode-vi "'" send-keys -X copy-pipe-and-cancel "yank"
bind-key -T copy-mode-vi "_" send -X copy-pipe "tmux loadb -" \; send-keys enter
bind-key -T copy-mode-vi 'r' send-keys -X rectangle-toggle
bind-key -T copy-mode-vi 'u' send-keys -X page-up
bind-key -T copy-mode-vi 'd' send-keys -X page-down
bind-key -T copy-mode-vi Space command-prompt -i -p "search-forward" "send -X search-forward-incremental \"%%%\""

bind-key -T copy-mode-vi C-u send-keys -X scroll-up
bind-key -T copy-mode-vi C-d send-keys -X scroll-down
unbind-key -T copy-mode-vi y
bind-key -T copy-mode-vi y send-keys -X cursor-left
bind-key -T copy-mode-vi h send-keys -X cursor-down
bind-key -T copy-mode-vi a send-keys -X cursor-up
bind-key -T copy-mode-vi e send-keys -X cursor-right

# Issuing :list-keys -T copy-mode-vi in tmux will show the full table of commands in copy mode.
# bind-key -t vi-copy    C-b page-up                                                      
# bind-key -t vi-copy    C-c cancel
# bind-key -t vi-copy    C-e scroll-down
# bind-key -t vi-copy    C-f page-down
# bind-key -t vi-copy    C-h cursor-left
# bind-key -t vi-copy  Enter copy-selection
# bind-key -t vi-copy    C-y scroll-up
# bind-key -t vi-copy Escape clear-selection
# bind-key -t vi-copy  Space begin-selection
# bind-key -t vi-copy      $ end-of-line
# bind-key -t vi-copy      , jump-reverse
# bind-key -t vi-copy      / search-forward
# bind-key -t vi-copy      0 start-of-line
# bind-key -t vi-copy      1 start-number-prefix
# bind-key -t vi-copy      2 start-number-prefix
# bind-key -t vi-copy      3 start-number-prefix
# bind-key -t vi-copy      4 start-number-prefix
# bind-key -t vi-copy      5 start-number-prefix
# bind-key -t vi-copy      6 start-number-prefix
# bind-key -t vi-copy      7 start-number-prefix
# bind-key -t vi-copy      8 start-number-prefix
# bind-key -t vi-copy      9 start-number-prefix
# bind-key -t vi-copy      : goto-line
# bind-key -t vi-copy      ; jump-again
# bind-key -t vi-copy      ? search-backward
# bind-key -t vi-copy      B previous-space
# bind-key -t vi-copy      D copy-end-of-line
# bind-key -t vi-copy      E next-space-end
# bind-key -t vi-copy      F jump-backward
# bind-key -t vi-copy      G history-bottom
# bind-key -t vi-copy      H top-line
# bind-key -t vi-copy      J scroll-down
# bind-key -t vi-copy      K scroll-up
# bind-key -t vi-copy      L bottom-line
# bind-key -t vi-copy      M middle-line
# bind-key -t vi-copy      N search-reverse
# bind-key -t vi-copy      T jump-to-backward
# bind-key -t vi-copy      W next-space
# bind-key -t vi-copy      ^ back-to-indentation
# bind-key -t vi-copy      b previous-word
# bind-key -t vi-copy      e next-word-end
# bind-key -t vi-copy      f jump-forward
# bind-key -t vi-copy      g history-top
# bind-key -t vi-copy      h cursor-left
# bind-key -t vi-copy      j cursor-down
# bind-key -t vi-copy      k cursor-up
# bind-key -t vi-copy      l cursor-right
# bind-key -t vi-copy      n search-again
# bind-key -t vi-copy      q cancel
# bind-key -t vi-copy      t jump-to-forward
# bind-key -t vi-copy      v rectangle-toggle
# bind-key -t vi-copy      w next-word
# bind-key -t vi-copy BSpace cursor-left
# bind-key -t vi-copy  NPage page-down
# bind-key -t vi-copy  PPage page-up
# bind-key -t vi-copy     Up cursor-up
# bind-key -t vi-copy   Down cursor-down
# bind-key -t vi-copy   Left cursor-left
# bind-key -t vi-copy  Right cursor-right
# bind-key -t vi-copy   C-Up scroll-up
# bind-key -t vi-copy C-Down scroll-down 

# -------------------- Navigation -------------------- #
# is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
# bind-key -n 'M-h' if-shell "$is_vim" 'send-keys M-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
# bind-key -n 'M-j' if-shell "$is_vim" 'send-keys M-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
# bind-key -n 'M-k' if-shell "$is_vim" 'send-keys M-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
# bind-key -n 'M-l' if-shell "$is_vim" 'send-keys M-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }
# bind-key -n C-M-f resize-pane -Z
# bind -n C-Left if-shell "$is_vim" 'send-keys C-Left' 'resize-pane -L 2'
# bind -n C-Down if-shell "$is_vim" 'send-keys C-Down' 'resize-pane -D 2'
# bind -n C-Up if-shell "$is_vim" 'send-keys C-Up' 'resize-pane -U 2'
# bind -n C-Right if-shell "$is_vim" 'send-keys C-Right' 'resize-pane -R 2'

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?\.?(view|n?vim?x?)(-wrapped)?(diff)?$'"
bind-key -n 'C-y' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
bind-key -n 'C-a' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-e' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }
bind-key -T copy-mode-vi 'C-y' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-a' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-e' if -F '#{pane_at_right}' '' 'select-pane -R'

bind-key -n 'C-Y' if-shell "$is_vim" 'send-keys C-Left' 'resize-pane -L 10'
bind-key -n 'C-H' if-shell "$is_vim" 'send-keys C-Down' 'resize-pane -D 10'
bind-key -n 'C-A' if-shell "$is_vim" 'send-keys C-Up' 'resize-pane -U 10'
bind-key -n 'C-E' if-shell "$is_vim" 'send-keys C-Right' 'resize-pane -R 10'

# bind-key -n 'C-y' select-pane -L
# bind-key -n 'C-h' select-pane -D
# bind-key -n 'C-a' select-pane -U
# bind-key -n 'C-e' select-pane -R
bind-key -n 'C-y' select-pane -L
bind-key -n 'C-h' select-pane -D
bind-key -n 'C-a' select-pane -U
bind-key -n 'C-e' select-pane -R


# Toggle ` as the toggle in in NON-VIM
unbind-key C-b
set -g prefix C-F12
bind-key C-F12 send-prefix
# set -g prefix C-a
# bind-key C-a send-prefix

bind | split-window -h
# bind \ split-window -v

# set -g prefix `
# bind C-Space send-prefix
# bind-key ` if-shell "$is_vim" "send-keys `" "set -g prefix2 `\; bind-key ` send-prefix"

# set -g prefix C-Space
# bind C-Space send-prefix
# set -gu prefix2
# set -g prefix2 M-F12
# bind C-a send-prefix


# Windows navigation (Vim-like)
bind-key -n M-y previous-window
bind-key -n M-e next-window

bind-key -T copy-mode-vi 'M-y' previous-window
bind-key -T copy-mode-vi 'M-e' next-window

# bind-key -n M-p last-window
# bind-key -n M-n new-window
bind-key -n M-x confirm-before kill-window

bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# Split window into panes
# unbind-key '"'
# unbind-key %
bind-key -n M-. split-window -h
bind-key -n M-- split-window -v
bind-key -n M-/ next-layout
bind-key -n M-? previous-layout

# Panes
# bind-key -n M-l list-panes


# ----------========== TPM ==========---------- #
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'jaclu/tmux-menus'
set -g @plugin 'tmux-plugins/tmux-pain-control'

# tmux-yank - advanced copy mode
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @shell_mode 'vi'

# sticky fingers
set -g @plugin 'fcsonline/tmux-thumbs'
unbind f
set -g @thumbs-position left
set -g @thumbs-osc52 0
set -g @thumbs-key f
set -g @thumbs-contrast 1
set -g @thumbs-bg-color '#1688f0'
set -g @thumbs-fg-color '#080808'
set -g @thumbs-hint-bg-color '#ff00af'
set -g @thumbs-hint-fg-color '#FFFFFF'
set -g @thumbs-select-bg-color '#ebdbb2'
set -g @thumbs-select-fg-color '#1d2021'
set -g @thumbs-command 'tmux set-buffer -- {} && tmux display-message \"Copied {}\" && printf "{}" | yank'

# status icon
set -g @plugin 'MunifTanjim/tmux-mode-indicator'
set -g @mode_indicator_empty_prompt ' ◇ '
set -g @mode_indicator_empty_mode_style 'bg=tmux_conf_theme_colour_2,fg=tmux_conf_theme_colour_11'
set -g @mode_indicator_prefix_prompt ' ◈ '
set -g @mode_indicator_prefix_mode_style 'bg=color4,fg=color0'
set -g @mode_indicator_copy_prompt '  '
set -g @mode_indicator_copy_mode_style 'bg=color5,fg=color0'
set -g @mode_indicator_sync_prompt '   '
set -g @mode_indicator_sync_mode_style 'bg=color4,fg=color0'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# Disable default vim-tmux-navigator mappings (conflicts with Graphite layout)
set -g @vim-tmux-navigator-no-mappings 1
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @sessionx-bind 'o'

# ----------========== Themes ==========---------- #
# set -g @plugin 'dreamsofcode-io/catppuccin-tmux'
# set -g @plugin 'egel/tmux-gruvbox'
set -g @plugin 'dracula/tmux'
set -g @dracula-border-contrast true
set -g @dracula-show-flags true
set -g @dracula-show-powerline true
# for left
set -g @dracula-show-left-sep 
# for right symbol (can set any symbol you like as separator)
set -g @dracula-show-right-sep 
set -g @dracula-powerline-bg-transparent true
# the left separator symbol is inversed with a transparent background, you can modify it with any symbol you like
set -g @dracula-inverse-divider 
# Dislay hostname on left corner
set -g @dracula-show-left-icon "#h | #S"

set -g @dracula-battery-label " "
set -g @dracula-show-battery-status true
set -g @dracula-no-battery-label " "

# CPU Usage:    󰍛 󰘚 󰻟 󰻠
# If false, display in percentage terms
set -g @dracula-cpu-display-load false
set -g @dracula-cpu-usage-label "󰻠 "
set -g @dracula-cpu-usage-colors "yellow dark_gray"
set -g @dracula-ram-usage-label " "

# network-bandwidth is long, and subject to network card name
set -g @dracula-network-bandwidth "eno0"
set -g @dracula-network-bandwidth-show-interface true
set -g @dracula-network-bandwidth-interval 5

set -g @dracula-military-time true
set -g @dracula-time-format "%F %R %Z"

# Weather
set -g @dracula-show-fahrenheit false
set -g @dracula-fixed-location "Singapore"
set -g @dracula-show-location true

set -g @dracula-plugins "cpu-usage ram-usage battery sys-temp weather time"

set -g @dracula-colors "
# Dracula Color Pallette
white='#f8f8f2'
gray='#44475a'
dark_gray='#282a36'
light_purple='#bd93f9'
dark_purple='#6272a4'
cyan='#8be9fd'
green='#f1fa8c'
orange='#ffb86c'
red='#FF838B       '
pink='#ff79c6'
yellow='#AAE382'
"

# ----------========== END ==========---------- #
run '~/.local/share/tmux/plugins/tpm/tpm'

# Override plugin bindings with Graphite layout (must be after TPM)
bind-key -n 'C-y' select-pane -L
bind-key -n 'C-h' select-pane -D
bind-key -n 'C-a' select-pane -U
bind-key -n 'C-e' select-pane -R

bind-key -T copy-mode-vi y send-keys -X cursor-left
