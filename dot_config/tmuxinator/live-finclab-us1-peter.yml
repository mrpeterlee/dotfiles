name: live-finclab-us1-peter
root: /lab/paper/ts/lean

# Specifies (by name or index) which window will be selected on project startup. If not set, the first window is used.
startup_window: "1"
# Specifies (by index) which pane of the specified window will be selected on project startup. If not set, the first pane is used.
startup_pane: 1

windows:
  - Live:
      layout: even-vertical
      panes:
        - us-bitfinex:
            - sleep 900
            # - export LATEST_FOLDER=$(find /lab/paper/ts/lean/live -maxdepth 1 -name "crypto.peter-bitfinex.margin*" -type d | sort -t '\0' -n | tail -n 1) && echo "Running live Bitfinex Peter (Margin) account from location $LATEST_FOLDER"
            # - cd $LATEST_FOLDER
            - cd /lab/paper/ts/lean/live/crypto.peter-bitfinex.margin && ac live start . --brokerage Bitfinex --data-provider-live Bitfinex --lean-config "/lab/paper/ts/lean/lean.json"
            # hack: disable --data-provider local ==> see if it works.
            # --data-provider Local
            # --image "quantconnect/lean:latest"

        # - us-ibkr:
        #     - current_epoch=$(date +%s) && target_epoch=$(date -d "$(date '+%Y-%m-%d') 10:00" +%s) && sleep_seconds=$(( $target_epoch - $current_epoch )) && echo "IBKR live trading to be launched at EST 10 AM Sunday ($sleep_seconds seconds from now..)"
        #     - sleep $sleep_seconds
        #     - cd /lab/paper/ts/lean && lean data download --dataset "US Equity Security Master"
        #     - export LATEST_FOLDER=$(find /lab/paper/ts/lean/live -maxdepth 1 -name "equity.peter-us-ibkr.margin*" -type d | sort -t '\0' -n | tail -n 1) && echo "Running live Equity US Peter-IBKR account from location $LATEST_FOLDER"
        #     - cd $LATEST_FOLDER
        #     # - ac live start . --brokerage "Interactive Brokers" --data-provider-live "Interactive Brokers" --data-provider-historical "Local" --lean-config "/lab/paper/ts/lean/lean.json"
        #     - cd /lab/paper/ts/lean && lean live deploy live/equity.peter-us-ibkr.margin --brokerage "Interactive Brokers" --data-provider-live "Interactive Brokers" --data-provider-historical "Local" --lean-config "/lab/paper/ts/lean/lean.json"

        # - us-ibkr-cron:
        #     - cd /lab/paper/ts/ts/cronlab
        #     - ipython
        #     - run cron.equity.peter-us-ibkr.margin.py
        #
        - cn-pingan-chen:
            - current_epoch=$(date +%s) && target_epoch=$(date -d "$(date '+%Y-%m-%d') 16:00" +%s) && sleep_seconds=$(( $target_epoch - $current_epoch )) && echo "Pingan-Chen live trading to be launched at EST 16:00 PM Today ($sleep_seconds seconds from now..)"
            - sleep $sleep_seconds
            - export LATEST_FOLDER=$(find /lab/paper/ts/lean/live -maxdepth 1 -name "equity.chenjia-cn-pingan.cash*" -type d | sort -t '\0' -n | tail -n 1) && echo "Running live Equity CN ChenJia-PINGAN account from location $LATEST_FOLDER"
            - cd $LATEST_FOLDER
            - ac live start . --brokerage "Zerodha" --data-provider-live "Zerodha" --data-provider-historical "Local" --lean-config "/lab/paper/ts/lean/lean.json"

        - cn-pingan-chen-cron:
            - cd /lab/paper/ts/ts/cronlab
            - ipython
            - run cron.equity.chenjia-cn-pingan.cash.py
